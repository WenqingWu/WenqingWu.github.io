<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Centos 发行版及内核升级 | 动者静之基，清者浊之源</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Centos 发行版及内核升级</h1><a id="logo" href="/.">动者静之基，清者浊之源</a><p class="description">Victor's Blog</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Centos 发行版及内核升级</h1><div class="post-meta">Mar 12, 2019</div><div class="post-content"><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>在实际工作中，时常会遇到换机器或者单纯由于软件对内核版本的要求，需要升级服务器的系统。笔者工作中最常用的Linux发行版是CentOS，所以有时会遇到需要自己升级系统的情况。网上搜到的升级方式比较杂，笔者在这里简单总结一下，可以作为参考。实际操作过程基本是一致的，中间有些涉及到内核中的文件，可能需要对应到自己实际的机器。</p>
<h2 id="2-CentOS发行版升级"><a href="#2-CentOS发行版升级" class="headerlink" title="2. CentOS发行版升级"></a>2. CentOS发行版升级</h2><p>这里以centos 7.4 升级到 centos 7.6为例，</p>
<h3 id="2-1-选择镜像站点"><a href="#2-1-选择镜像站点" class="headerlink" title="2.1 选择镜像站点"></a>2.1 选择镜像站点</h3><p>打开国内的一个centos镜像站点，点击它站点内的centos目录，然后查看是否有7.6.1810这样一个目录。如下面图中所示（笔者这里采用的是清华开源软件镜像站），</p>
<p><img src="/2019/03/12/CentOS-发行版及内核升级/centos-1.png" alt=""></p>
<p>确认存在图中目录后，再点到里面去，确认目录中所有的包已经更新完毕。在CentOS7.6刚发布出来的时候，有的站点点进去，会发现7.6.1810目录创建了，但是里面没有内容。这样的话是没法更新的。像上图就是正常更新的。</p>
<h3 id="2-2-编辑基础源包文件"><a href="#2-2-编辑基础源包文件" class="headerlink" title="2.2 编辑基础源包文件"></a>2.2 编辑基础源包文件</h3><p>确认无误后，回到需要升级的主机上，以root身份登陆以后，切换到/etc/yum.repos.d目录下，编辑系统的基础源包文件CentOS-Base.repo，命令是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># cd /etc/yum.repos.d/</span></span><br><span class="line"><span class="meta"># vim CentOS-Base.repo</span></span><br></pre></td></tr></table></figure>
<p>如图，</p>
<p><img src="/2019/03/12/CentOS-发行版及内核升级/centos-2.png" alt=""></p>
<p>进去后，笔者的机器上显示如图，</p>
<p><img src="/2019/03/12/CentOS-发行版及内核升级/centos-3.png" alt=""></p>
<p>若其中有mirrorlist，注释掉mirrorlist，笔者这里并没有，所以不用注释；然后对baseurl进行修改，改为安装源对应的os目录，接着再将之前设置为不启用的enabled=0改为enabled=1，修改完成后如下图中所示：</p>
<p><img src="/2019/03/12/CentOS-发行版及内核升级/centos-4.png" alt=""></p>
<h3 id="2-3-更新"><a href="#2-3-更新" class="headerlink" title="2.3 更新"></a>2.3 更新</h3><p>全部修改完成后，保存退出，然后执行更新命令：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># yum update -y</span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-重启验证"><a href="#2-4-重启验证" class="headerlink" title="2.4 重启验证"></a>2.4 重启验证</h3><p>我们耐心等待它下载更新完毕，等所有的包都更新好以后，我们重启系统。等待系统重启完毕后，我们执行命令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># cat /etc/redhat-release</span></span><br></pre></td></tr></table></figure>
<p>可以看到，Linux发行版已经更新为CentOS 7.6。</p>
<h2 id="3-CentOS-内核升级"><a href="#3-CentOS-内核升级" class="headerlink" title="3. CentOS 内核升级"></a>3. CentOS 内核升级</h2><p>Linux 只表示内核。各大 Linux 发行版（RedHat、Ubuntu、CentOS 等）在内核基础上集成了其他的一系列软件，按照各自的版本规则发布。例如 CentOS 7.5 中，通过 uname -r 查看内核版本时，会看到 3.10.0-957.el7.x86_64，表示对应的 Linux 内核版本是 3.10。</p>
<h3 id="3-1-更新仓库"><a href="#3-1-更新仓库" class="headerlink" title="3.1 更新仓库"></a>3.1 更新仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y update</span></span><br></pre></td></tr></table></figure>
<p>-y 选项可以在每次需要确认时，自动使用 yes，节省时间。</p>
<h3 id="3-2-启用ELRepo仓库"><a href="#3-2-启用ELRepo仓库" class="headerlink" title="3.2 启用ELRepo仓库"></a>3.2 启用ELRepo仓库</h3><p>ELRepo 仓库是基于社区的用于企业级 Linux 仓库，提供对 RedHat Enterprise (RHEL) 和 其他基于 RHEL的 Linux 发行版（CentOS、Scientific、Fedora 等）的支持。ELRepo 聚焦于和硬件相关的软件包，包括文件系统驱动、显卡驱动、网络驱动、声卡驱动和摄像头驱动等。</p>
<p>启用 ELRepo 仓库(可能需要root权限)：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># rpm --import https:<span class="comment">//www.elrepo.org/RPM-GPG-KEY-elrepo.org</span></span></span><br><span class="line"><span class="meta"># rpm -Uvh http:<span class="comment">//www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-查看可用内核"><a href="#3-3-查看可用内核" class="headerlink" title="3.3 查看可用内核"></a>3.3 查看可用内核</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># yum --disablerepo=<span class="meta-string">"*"</span> --enablerepo=<span class="meta-string">"elrepo-kernel"</span> list available</span></span><br></pre></td></tr></table></figure>
<p>笔者运行上述命令，结果如图，</p>
<p><img src="/2019/03/12/CentOS-发行版及内核升级/centos-5.png" alt=""></p>
<p>可以看到，有 4.4 和 5.0 两个版本可以使用。</p>
<h3 id="3-4-安装指定内核"><a href="#3-4-安装指定内核" class="headerlink" title="3.4 安装指定内核"></a>3.4 安装指定内核</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># yum --enablerepo=elrepo-kernel install kernel-lt</span></span><br></pre></td></tr></table></figure>
<p>(若要安装5.0，可以选项kernel-ml)<br>–enablerepo 选项开启 CentOS 系统上的指定仓库。默认开启的是 elrepo，这里用 elrepo-kernel 替换。</p>
<h3 id="3-5-修改内核启动顺序"><a href="#3-5-修改内核启动顺序" class="headerlink" title="3.5 修改内核启动顺序"></a>3.5 修改内核启动顺序</h3><p>我们知道，centos 6.x是通过/etc/grub.conf就行内核启动顺序修改的，而且比较直观查看。但centos 7的系统和6就不一样了，是通过grub2为引导程序。下边简单说下centos 7的内核启动顺序如何修改。</p>
<h4 id="3-5-1-查看当前系统有几个内核"><a href="#3-5-1-查看当前系统有几个内核" class="headerlink" title="3.5.1 查看当前系统有几个内核"></a>3.5.1 查看当前系统有几个内核</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># cat /boot/grub2/grub.cfg |grep menuentry</span></span><br><span class="line">(对应的文件也可能是/boot/efi/EFI/centos/grub.cfg)</span><br></pre></td></tr></table></figure>
<p><img src="/2019/03/12/CentOS-发行版及内核升级/centos-6.png" alt=""></p>
<h4 id="3-5-2-设置默认的启动内核"><a href="#3-5-2-设置默认的启动内核" class="headerlink" title="3.5.2 设置默认的启动内核"></a>3.5.2 设置默认的启动内核</h4><p>比如我们选择上边中的CentOS Linux (4.4.176-1.el7.elrepo.x86_64) 7 (Core)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># grub2-<span class="built_in">set</span>-<span class="keyword">default</span> <span class="string">"CentOS Linux (4.4.176-1.el7.elrepo.x86_64) 7 (Core)"</span></span><br></pre></td></tr></table></figure>
<h4 id="3-5-3-验证是否修改成功"><a href="#3-5-3-验证是否修改成功" class="headerlink" title="3.5.3 验证是否修改成功"></a>3.5.3 验证是否修改成功</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># grub2-editenv <span class="built_in">list</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-重启验证"><a href="#3-6-重启验证" class="headerlink" title="3.6 重启验证"></a>3.6 重启验证</h3><p>重启机器后，使用uname -r命令查看内核是否已修改。</p>
<h3 id="3-7-移除旧内核（非必须，略）"><a href="#3-7-移除旧内核（非必须，略）" class="headerlink" title="3.7 移除旧内核（非必须，略）"></a>3.7 移除旧内核（非必须，略）</h3><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://jingyan.baidu.com/article/020278112e95401bcc9ce533.html" target="_blank" rel="noopener">百度经验</a><br><a href="https://blog.csdn.net/kikajack/article/details/79396793" target="_blank" rel="noopener">CSDN博客</a><br><a href="https://www.cnblogs.com/cnsong/p/7058000.html" target="_blank" rel="noopener">cnblogs博客</a></p>
</div><div class="tags"><a href="/tags/Linux/">Linux</a><a href="/tags/Technology/">Technology</a><a href="/tags/OS/">OS</a></div><div class="post-nav"><a class="next" href="/2018/12/10/Linux-下的PF-PACKET和SOCK-RAW/">Linux 下的PF_PACKET和SOCK_RAW</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'WenqingWu',
  repo: 'WenqingWu.github.io',
  oauth: {
    client_id: '0e0b6aa95e008b07bd07',
    client_secret: '379daa73cda0a3049b832cb8b5bd2541e0bfa048',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">technology</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Technology/" style="font-size: 15px;">Technology</a> <a href="/tags/OS/" style="font-size: 15px;">OS</a> <a href="/tags/Linux-TCP-IP-DCN/" style="font-size: 15px;">Linux - TCP/IP - DCN</a> <a href="/tags/technology/" style="font-size: 15px;">technology</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/Linux-DPDK-DCN/" style="font-size: 15px;">Linux - DPDK - DCN</a> <a href="/tags/mTCP/" style="font-size: 15px;">mTCP</a> <a href="/tags/DCN/" style="font-size: 15px;">DCN</a> <a href="/tags/DPDK/" style="font-size: 15px;">DPDK</a> <a href="/tags/C/" style="font-size: 15px;">C</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/12/CentOS-发行版及内核升级/">Centos 发行版及内核升级</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/Linux-下的PF-PACKET和SOCK-RAW/">Linux 下的PF_PACKET和SOCK_RAW</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/08/pdump-DPDK抓包工具/">pdump DPDK抓包工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/Linux-时间函数小结/">Linux 时间函数小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/26/C语言开发调试经验记录/">C语言开发调试经验记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/18/mTCP-Code-Reading/">mTCP Code Reading</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/17/hexo introduction/">hexo使用简介</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://github.com/WenqingWu" title="Github of Mine" target="_blank">Github of Mine</a><ul></ul><a href="https://github.com/eunyoung14/mtcp" title="mTCP" target="_blank">mTCP</a><ul></ul><a href="https://www.dpdk.org/" title="DPDK" target="_blank">DPDK</a><ul></ul><a href="https://www.v2ex.com/" title="V2EX" target="_blank">V2EX</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">动者静之基，清者浊之源.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>